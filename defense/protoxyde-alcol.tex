%! Author = ewan
%! Date = 10/6/25

% Preamble
\documentclass[11pt]{article}

% Packages
\usepackage{amsmath}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{pdfpages}
\usepackage{graphicx}
\usepackage[toc,page]{appendix}
\usepackage{caption}
\usepackage{soul}
\usepackage{csquotes}
\usepackage[T1]{fontenc}


% Document
% Document
\begin{document}

    \title{
            { \textbf{Security Protocols and Verification}} \\[1ex]
        {\small Defense of Cryptographic Protocol}
    }


    \author{
        Garance Frolla \\
        Ely Marthouret \\
        Ewan Decima\\ \\
        Team: \textbf{ASKO OM8464A2}
    }

    \date{September / November 2025}


    \maketitle
    \tableofcontents
    \newpage

    \section{Attack against PROTOxyde d'alCOl}

    \subsection{Notation}
    \begin{itemize}
        \item Let $\mathcal{K}_I$ denote the set of all facts known to the intruder $I$.
        \item Let $\bigl(K_I\bigr)_{I \in \mathcal{I}}$ the set of key use by $I$ during the \textit{bruteforce} step.
        \item Let $\mathcal{M}$ denote the set of all  messages sent during a communication between to agents.
        \item Let $M_{1,A} \in \mathcal{M}$ denote the first message sends by Alice, i.e., $M_{1,A} = \{|\langle A,N_A \rangle|\}_{K_{AB}}$
        \item Let $s(\cdot, \cdot)$ denote the sender function, i.e., $s(m,x)$ means message $M$ is sent by agent $C$.
        \item Let $[\cdot]_{(\cdot)}$ denote the extract function of a tuple message, i.e., for
                $ M = \langle m_1, m2, ..., m_n \rangle \in \mathcal{M}$, $[M]_i = m_i \quad \forall i \in [|1,n|]$.
        \item Let $\langle X',Y',Z', \Sigma' \rangle$ denote four random value.
    \end{itemize}
    

    \subsection{The attack}
    \begin{itemize}
        \item First this our understanding of your attack : the intruder $I$ steal the first Alice's message :
        $M_{1,A}$. At this step $ K(N_A) \notin \mathcal{K}_I  $ and $K\bigl(K_{AB}\bigr) \notin \mathcal{K}_I$.


        \item After that, $I$ impersonates S by crafting the ticket $\{|\langle A,\tau,\lambda, K_{AB}\rangle|\}_{K_{BS}}$,
                replacing $K_{BS}$ with keys $K_I$ to form $T_I := \{|\langle X',Y',Z', \Sigma' \rangle|\}_{K_{I}}$
            and sending $M_{1,A}$ and $T_I$ to $B$.
        
        \item $B$ gets $M_{1,A}$. At this point $K\bigl( S(M_{1,A},A) \bigr) \notin \mathcal{K}_B$.
                But it's normal according to the ASKO OM8464A2 protocol. Then $B$ gets the crafted ticket $T_I$. $B$
                will decipher it with $K_{BS}$ and send back to $[dec(T_I, K_{BS})]_1$
                \begin{center}
                    $\Bigl\{\Bigl|dec\bigl(\{|N_A + 1|\}_K_{AB},[dec(T_I, K_{BS})]_4\bigr) \Bigr|\Bigr\}_{[dec(T_I, K_{BS})]_4}$
                \end{center}
        For better understanding, let us denote $[dec(T_I, K_{BS})]_1$, $[dec(T_I, K_{BS})]_2$, $[dec(T_I, K_{BS})]_3$, $[dec(T_I, K_{BS})]_4$
        as $X,Y,Z,\Sigma$ respectively.


        \item The attack lies on the fact that identities are short bitstring,  $B$ will always decipher the ticket
                $T_I$ with his symmetric key $K_{BS}$, and hoping that:
                \begin{center}
                    $\exists \: J \in \mathcal{I} \: | J \neq BS \wedge \: dec(T_J, K_{BS}) = \langle A,Y,Z, \Sigma \rangle$.
                \end{center}
                With such a key $K_J$, $B$ will think that $\Sigma$ is $K_{AB}$. At this point $K\bigl(\Sigma \bigr) \notin \mathcal{K}_I$
                and $K\bigr( K_J \bigl) \notin \mathcal{K}_I$.

    \end{itemize}

    \section{Refutation}
        \subsection{Symmetric Encryption Specification}



            The assumption that if $B$ uses a different key $K_{BS} \neq K_I$ that the one used for encryption of $T_I$ by the
            intruder the decrypted output will be garbage (random-looking bytes) is questionable and depend a lot of
            the code implementation of the protocol. In fact, if the implementation uses an authenticated mode,
            like AES-GCM or ChaCha20-Poly135, decryption will fail completely. But if the implementation uses AES-CBC
            it won't throw an error and $B$ will get nonsense plaintext.

            \vspace{0.5cm}

            Moreover if $I$ uses the wrong cipher configuration such ad AES-ECB instead of AES-CB or AES-GCM, $B$ will
            end up with completely unreadable results, and if the padding is incorrect (for example, PKCS7 was expected
            but not applied), $B$ will likely encounter padding errors or corrupted trailing bytes.

            \vspace{0.5cm}

            Finally, if $I$ uses the wrong Initial Vector (IV) or nonce, the first block (or few blocks) of
            decrypted data will be corrupted. The rest might still decrypt correctly depending on the mode (e.g., CBC
            mode propagates errors, but CTR mode only corrupts corresponding parts)



            \vspace{0.5cm}

            Since the protocol design project did not require us to specify the actual implementation of the protocol
            but only its theoretical aspect, the choice of the encryption scheme cannot be considered a point of attack;
            we can assume the encryption scheme to be flawless. For example in the Needham-Schroeder template, there is
            no mention of the encryption scheme.


    \subsection{Litterature}

    In cryptographic literature, and particularly in theoretical descriptions of protocols (for key exchange,
    authentication, etc.), there are no specifications regarding the choice of implementation or hardware aspects. For
    example, in \textit{Applied Cryptography, Second Edition} by Bruce Schneier (translated by Laurent Viennot), in the
    section 'Authentication and Key Exchange,' the theoretical description of the Needham–Schroeder protocol does not
    mention the choice of the symmetric encryption algorithm, nor the size used to encode the participants’ identities.
    (\textit{See ~\ref{fig:NS_BS} in Appendices~\ref{ann:NS_BS}})



    \subsection{Timestamp}
    In this attack scenario, the main objective of $I$ is to find a symmetric key $K_I$ such that for a fixed
    $M = \langle X',Y',Z', \Sigma'\rangle \in \mathcal{M} $
    \begin{center}
        $dec(enc(\langle X',Y',Z', \Sigma'\rangle, K_I), K_{BS}) = \langle A,Y,Z, \Sigma \rangle $
    \end{center}
    i.e.

    \begin{center}
        $enc(\langle X',Y',Z', \Sigma'\rangle, K_I) = enc(\langle A,Y,Z, \Sigma \rangle, K_{BS}) $
    \end{center}

    In your attack you omit an important point: $B$ process a check on the timestamp $\tau$.  That is why $Y$ must be
    equal to a valid timestamp (coded on 64 bit to avoid the \textit{Year 2038 problem}) and $Z$ must be a valid lifetime.
    This greatly complicates the brute-force attack. The intruder must not be content with $X = A$ but must (indirectly)
    generate a timestamp $Y = \tau$ and a lifetime $Z = \lambda$ such that $\tau > t - \lambda$ where $t$ is the time
    when $B$ will get $T_I$.

    \vspace{0.5cm}

    Let us estimate the computational complexity of this brute-force attack. Assuming AES-128 encryption (128-bit keys),
    the keyspace contains $2^{128}$ possible keys. For a random key $K_I$, the probability that decrypting with $K_{BS}$ produces
    values satisfying all constraints is the product of individual probabilities:
    \begin{itemize}
        \item Probability that $[dec(T_I, K_{BS})]_1 = A$ : $P( "X=A" ) = \frac{1}{2^1} = \frac{1}{2}$
        \item  Probability that $[dec(T_I, K_{BS})]_2 = \tau$ is a valid timestamp within $\pm1$ hour window: $P("Y = \tau")\simeq \frac{2^{12}}{2^{64}}$
        \item Probability that $[dec(T_I, K_{BS})]_3 = \lambda$ is a valid lifetime (assuming 32-bit encoding with $2^{10}$ valid
                 values): $P("Z = \lambda") \simeq \frac{2^{10}}{2^{32}}$
    \end{itemize}

    The combined probability is approximately:

    \begin{center}
        $\frac{1}{2} \times \frac{2^{12}}{2^{64}} \times \frac{2^{10}}{2^{32}} = 2^{-75}$
    \end{center}

    Therefore, the expected number of candidate keys $K_I$ that satisfy all constraints is:
    \begin{center}
        $2^{128} \times 2^{-75} = 2^{53}$ keys
    \end{center}

    Even in the worst case where $A$ (and this choice of yours is questionable) is encoded on only 1 bit, the intruder
    would need to test: $2^{53}$ keys at $10^9$ operations per second $\simeq \frac{9 \times  10^{15}}{10^9} = 9 \times 10^6$ seconds $\simeq 104$ days.


  


    \subsection{Bruteforce Issues}
    
    Crucially, since $K_{BS} \notin K_I$, $I$ cannot verify locally whether a
    candidate $K_I$ produces the correct decryption. Instead, $I$ must test
    each of the $2^{53}$ candidate keys through interaction with $B$:

    \begin{itemize}
        \item For each candidate $K_I$, craft $T_I$
        \item Send $M_{1,A}$ and $T_I$ to $B$ over the network
        \item Observe $B$'s response to determine if the decryption was valid 
    \end{itemize}
    
    Assuming an optimistic round-trip time of 10 ms per attempt, testing $2^{53}$ candidates would require : 
    \begin{center}
        $2^{53} \times 0.01 \text{ s } \simeq 9 \times 10^{13} \text{ s } \simeq 2.9 \text{ million years} $
    \end{center}


    This estimate assumes:
    \begin{itemize}
        \item Perfect network conditions with no rate limiting
        \item $B$ processes all attempts without detection or blocking
        \item The intruder can maintain continuous communication for million of years
    \end{itemize}

    In practice, the attack is completely infeasible because:
    \begin{itemize}
        \item The timestamp constraint means candidates must be retested as time progresses
        \item Network's rate limit would increase the time by order of magnitude
        \item Finally the intruder is not \textit{Dracula}, he will not live forever ...
    \end{itemize}


    




    
    \section{Conclusion}
    We \underline{refuse this attack}, but we are ready to face another one.


    \newpage
    \begin{appendices}

        \section{Theoretical Needham-Schroeder}\label{ann:NS_BS}


        \begin{figure}[h!]
            \centering
            \includegraphics[width=0.8\textwidth]{NS-schneir}
            \caption{NS in \textit{Applied Cryptography} by Bruce Schneier}
            \label{fig:NS_BS}
        \end{figure}

    \end{appendices}


\end{document}